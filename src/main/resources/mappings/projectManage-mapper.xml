<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProjectManageDAO">
	 <resultMap type="pmVO" id="getMemberUse">
	 	<result property="userId" column="MEMBER_ID" />
	 	<result property="email" column="MEMBER_EMAIL"/>
	 	<result property="name" column="MEMBER_NAME"/>
	 </resultMap>
	 
	<select id="getDownProhibition" parameterType="int" resultType="String">
		SELECT DOWNPROHIBITION FROM PROJECTDIR WHERE PROJECT_ID = #{projectId}
	</select>

	<update id="changeDownProhibitionSetting" parameterType="pmVO">
		UPDATE PROJECTDIR SET DOWNPROHIBITION = #{downProhibition} WHERE PROJECT_ID = #{projectId} 
	</update>
	
	<select id="getUseStatistics" resultMap="getMemberUse" parameterType="int">
		SELECT B.MEMBER_ID, 
			NVL(B.COMPANYNAME,' ') AS COMPANYNAME, 
			NVL(B.DEPARTMENT,' ') AS DEPARTMENT, 
			NVL(B.MYPOSITION,' ') AS MYPOSITION, 
			NVL(B.COMPANYCALLNUMBER,' ')AS COMPANYCALLNUMBER, 
			C.MEMBER_NAME, C.MEMBER_EMAIL, D.WRITECOUNT, E.REPLYCOUNT 
			FROM PROJECT_LOOKUP A 
    			LEFT OUTER JOIN USERSETTING B ON (A.MEMBER_ID = B.MEMBER_ID)    
        		LEFT OUTER JOIN MEMBERINFO C ON (C.MEMBER_ID = A.MEMBER_ID)
            	LEFT OUTER JOIN (SELECT MEMBER_ID,COUNT(MEMBER_ID) AS WRITECOUNT FROM MAINPAGE_ARTICLE GROUP BY MEMBER_ID) D ON (C.MEMBER_ID = D.MEMBER_ID) 
            	LEFT OUTER JOIN (SELECT MEMBER_ID, COUNT(MEMBER_ID) AS REPLYCOUNT FROM ARTICLE_REPLY GROUP BY MEMBER_ID) E ON (C.MEMBER_ID = E.MEMBER_ID)
			WHERE A.PROJECT_ID = #{projectId}
	</select>
</mapper>
